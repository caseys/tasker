/*! tasker 12-08-2014 */
var tasker=function(){{var a=this.TaskView=React.createClass({displayName:"TaskView",getInitialState:function(){return{text:this.props.task.text,editing:""===this.props.task.text,trashed:this.props.task.trashed||!1}},componentDidMount:function(){var a=this;setTimeout(function(){a.setFocus()},20)},setFocus:function(){var a=this.refs.taskInput.getDOMNode();a.focus(),a.setSelectionRange(0,a.value.length)},goEditState:function(){this.setState({editing:!0},this.setFocus)},goReadState:function(){this.state.text&&this.state.text===this.props.task.text||this.props.editTask(this.props.task,{text:this.state.text}),this.setState({editing:!1})},setChecked:function(a){var b=a.target.checked;this.setState({checked:b}),this.props.editTask(this.props.task,{checked:b})},setTrashed:function(){var a=!this.state.trashed;this.setState({trashed:a}),this.props.editTask(this.props.task,{trashed:a}),this.goReadState()},handleKeyDown:function(a){27===a.which?(this.setState({text:this.props.task.text}),this.goReadState()):13===a.which&&this.goReadState()},handleChange:function(a){this.setState({text:a.target.value})},handleBlur:function(){this.state.editing&&this.goReadState()},render:function(){var a=this.props.task,b=React.addons.classSet,c=b({task:!0,edit:this.state.editing,active:!this.props.task.checked,trashed:this.state.trashed});return React.DOM.div({className:c,onDoubleClick:this.goEditState},React.DOM.input({type:"checkbox",ref:"taskCheck",className:"taskCheck",checked:this.props.task.checked,onChange:this.setChecked}),React.DOM.span({className:"taskText"},a.text),React.DOM.input({type:"text",ref:"taskInput",className:"taskInput",autofocus:"true",placeholder:"enter task text",value:this.state.text,onBlur:this.handleBlur,onChange:this.handleChange,onKeyDown:this.handleKeyDown}),React.DOM.input({type:"button",ref:"taskTrash",className:"taskTrash",onClick:this.setTrashed}))}});this.TaskerView=React.createClass({displayName:"TaskerView",getInitialState:function(){return{filter:"all"}},setAllFilter:function(){this.setState({filter:"all"})},setActiveFilter:function(){this.setState({filter:"active"})},setTrashedFilter:function(){this.setState({filter:"trashed"})},emptyTrash:function(){this.props.taskData.removeTrashed(),this.setState({filter:"all"})},shareTasks:function(){var a=window.location.href+"#"+this.props.taskData.shareHash();prompt("Share this URL",a)},handleNewTask:function(){this.props.taskData.addTask("")},handleEditTask:function(a,b){this.props.taskData.editTask(a,b)},render:function(){var b,c=this.props.taskData.tasks.map(function(b){return a({key:b.id,task:b,editTask:this.handleEditTask})},this),d=this.props.taskData.getNumTrashed(),e=this.props.taskData.getNumActive(),f=this.props.taskData.tasks.length-d,g=null;d&&(g=React.DOM.span({className:"filterButton trash",onClick:this.setTrashedFilter},"trash (",d,")")),f?b=React.DOM.span({className:"shareLink",onClick:this.shareTasks},"share"):"trashed"!==this.state.filter&&(console.log("adding the foo",this.state.filter),this.props.taskData.addTask("",!1));var h=React.addons.classSet,i=h({taskerApp:!0,filterAll:"all"===this.state.filter,filterActive:"active"===this.state.filter,filterTrashed:"trashed"===this.state.filter});return React.DOM.div({className:i},React.DOM.div({className:"header"},React.DOM.button({className:"taskAdd",onClick:this.handleNewTask},"+"),React.DOM.button({className:"emptyTrash",onClick:this.emptyTrash},"empty trash"),React.DOM.span(null,"tasks")),React.DOM.div({className:"taskList"},c),React.DOM.div({className:"taskFilter"},b,React.DOM.label(null,"showing: "),React.DOM.span({className:"filterButton all",onClick:this.setAllFilter},"all (",f,")"),React.DOM.span({className:"filterButton active",onClick:this.setActiveFilter},"active (",e,")"),g))}})}};tasker.prototype.data={},tasker.prototype.setData=function(a){this.data=a},tasker.prototype.render=function(){var a=this.TaskerView;React.renderComponent(a({taskData:this.data}),document.body)};var Tasker=new tasker,TaskerData=new taskerData;TaskerData.addListener(function(){Tasker.render()}),Tasker.setData(TaskerData),Tasker.render();var taskModel=function(a){this.id=a.id,this.text=a.text,this.checked=a.checked||!1,this.trashed=a.trashed||!1},taskerData=function(){this.listeners={},this.storageNamespace="tasker";var a,b=JSON.parse(localStorage.getItem(this.storageNamespace)||!1);try{a=JSON.parse(decodeURIComponent(String(window.location.hash).replace("#",""))||!1),window.location.hash=""}catch(c){a=!1}if(a&&b&&confirm("Shared tasks will be merged into the existing task last.")){for(var d={},e=0;e<b.length;e++)d[b[e].key]=e;for(console.log(d),e=0;e<a.length;e++){var f=d[a[e].key];"undefined"!=typeof f?b[f]=a[e]:b.push(a[e])}}else a&&!b&&(b=a);this.tasks=b||[]};taskerData.prototype.addTask=function(a,b){var c=new taskModel({id:this.getUid(),text:a,checked:!1},this);this.tasks.unshift(c),this.saveTasks(b)},taskerData.prototype.removeTask=function(a){this.tasks.splice(this.tasks.indexOf(a),1)},taskerData.prototype.removeTrashed=function(a){this.tasks=this.tasks.filter(function(a){return a.trashed===!0?!1:!0}),this.saveTasks(a)},taskerData.prototype.addListener=function(a){this.listeners[a]=a},taskerData.prototype.broadcastChanges=function(){for(var a in this.listeners)this.listeners[a]()},taskerData.prototype.shareHash=function(){var a=JSON.stringify(this.tasks);return encodeURIComponent(a)},taskerData.prototype.saveTasks=function(a){var b=JSON.stringify(this.tasks);localStorage.setItem(this.storageNamespace,b),a!==!1&&this.broadcastChanges()},taskerData.prototype.editTask=function(a,b){for(var c in b)a[c]=b[c];""===a.text.trim()&&this.removeTask(a),this.saveTasks()},taskerData.prototype.filterTasks=function(a,b){return"undefined"==typeof b&&(b=!0),this.tasks.filter(function(c){return c[a]==b?!0:void 0})},taskerData.prototype.getNumTrashed=function(){return this.filterTasks("trashed").length},taskerData.prototype.getNumActive=function(){var a=this.filterTasks("trashed",!1),b=a.filter(function(a){return a.checked!==!0});return b.length},taskerData.prototype.getUid=function(){return"xyxy-xxxx-yyyy".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})};